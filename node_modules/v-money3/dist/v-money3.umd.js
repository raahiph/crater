var __defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,o)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,__spreadValues=(e,t)=>{for(var o in t||(t={}))__hasOwnProp.call(t,o)&&__defNormalProp(e,o,t[o]);if(__getOwnPropSymbols)for(var o of __getOwnPropSymbols(t))__propIsEnum.call(t,o)&&__defNormalProp(e,o,t[o]);return e};!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["v-money3"]={},e.Vue)}(this,(function(e,t){"use strict";var o={debug:!1,masked:!1,prefix:"",suffix:"",thousands:",",decimal:".",precision:2,disableNegative:!1,disabled:!1,min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,allowBlank:!1,minimumNumberOfCharacters:0};const n=["+","-"],a=["decimal","thousands","prefix","suffix"];function l(e){const t=Math.floor(Number(e));return t!==1/0&&String(t)===e&&t>=0}function u(e){return t=0,o=e,n=20,Math.max(t,Math.min(o,n));var t,o,n}function r(e,t){const o=10**t;return(parseFloat(e)/o).toFixed(u(t))}function i(e){return e?e.toString():""}function d(e){return i(e).replace(/\D+/g,"")||"0"}function s(e,t){if(n.includes(e))throw new Error(`v-money3 "${t}" property don't accept "${e}" as a value.`);return!0}function c(e,t=o,n){t.debug&&console.log("utils format() - caller",n),t.debug&&console.log("utils format() - input1",e),null==e&&(e=0),t.allowBlank&&l(e)&&(e=r(e,u(t.precision))),"number"==typeof e?e=Number(e).toFixed(u(t.precision)):Number.isNaN(e)||(l(e)?e=Number(e).toFixed(u(t.precision)):/^-?[\d]*(\.[\d]+)?$/g.test(e)&&(n&&"component setup"!==n&&"directive mounted"!==n||(e=Number(e).toFixed(u(t.precision))))),t.debug&&console.log("utils format() - input2",e);const a=t.disableNegative?"":e.indexOf("-")>=0?"-":"",s=d(e.replace(t.prefix,"").replace(t.suffix,""));let c=Number(r(s,t.precision));if(t.debug&&console.log("utils format() - currency1",c),c>t.max?c=t.max:c<t.min&&(c=t.min),t.debug&&console.log("utils format() - currency2",c),c=c.toFixed(u(t.precision)),/^0(\.0+)?$/g.test(c)&&t.allowBlank)return"";const m=i(c).split(".");if(t.minimumNumberOfCharacters>0){const e=`${m[0]}`.length+`${m[1]}`.length,o=t.minimumNumberOfCharacters-e;if(o>0)for(let t=0;t<o;t+=1)m[0]=`0${m[0]}`}let f=m[0];const p=m[1];f=function(e,t){return e.replace(/(\d)(?=(?:\d{3})+\b)/gm,`$1${t}`)}(f,t.thousands);const g=t.prefix+a+function(e,t,o){return t?e+o+t:e}(f,p,t.decimal)+t.suffix;return t.debug&&console.log("utils format() - output",g),g}function m(e,t=o,n){t.debug&&console.log("utils unformat() - caller",n),t.debug&&console.log("utils unformat() - input",e);const a=t.disableNegative?1:e.indexOf("-")>=0?-1:1;let l=r(d(e.replace(t.prefix,"").replace(t.suffix,"")),t.precision);l=parseFloat(l)*a,l>t.max?l=t.max:e<t.min&&(l=t.min);let i=Number(l).toFixed(u(t.precision));return t.modelModifiers&&t.modelModifiers.number&&(i=parseFloat(i)),t.debug&&console.log("utils unformat() - output",i),i}function f(e){const t=document.createEvent("Event");return t.initEvent(e,!0,!0),t}var p=(e,t)=>(e=e||{},t=t||{},Object.keys(e).concat(Object.keys(t)).reduce(((o,n)=>(o[n]=void 0===t[n]?e[n]:t[n],o)),{}));let g=null;const v=(e,t,o)=>{if(g===e.value)return void(t.debug&&console.log("directive setValue() - lastKnownValue === el.value. Stopping here...",e.value));!function(e){for(const t of a)s(e[t],t)}(t);let n=e.value.length-e.selectionEnd;e.value=c(e.value,t,o),g=e.value,n=Math.max(n,t.suffix.length),n=e.value.length-n,n=Math.max(n,t.prefix.length),function(e,t){const o=()=>{e.setSelectionRange(t,t)};e===document.activeElement&&(o(),setTimeout(o,1))}(e,n),e.dispatchEvent(f("change"))};var b={mounted(e,t){if(!t.value)return;const n=p(o,t.value);if(n.debug&&console.log("directive mounted() - opt",n),"INPUT"!==e.tagName.toLocaleUpperCase()){const t=e.getElementsByTagName("input");1!==t.length||(e=t[0])}e.onkeydown=t=>{const o="Backspace"===t.code||"Delete"===t.code,a=e.value.length-e.selectionEnd==0;if(n.allowBlank&&o&&a&&0===m(e.value,0)&&(e.value="",e.dispatchEvent(f("change"))),"+"===t.key){const t=m(e.value,n);t<0&&(e.value=-1*t)}},e.oninput=()=>{/^[1-9]$/.test(e.value)&&(e.value=r(e.value,u(n.precision))),v(e,n,"directive oninput")},n.debug&&console.log("directive mounted() - el.value",e.value),v(e,n,"directive mounted")},updated(e,t){if(!t.value)return;const n=p(o,t.value);n.debug&&console.log("directive updated() - el.value",e.value),v(e,n,"directive updated")},beforeUnmount(e){e.onkeydown=null,e.oninput=null,e.onfocus=null}};const y=t.defineComponent({inheritAttrs:!1,name:"Money3",props:{debug:{required:!1,type:Boolean,default:!1},id:{required:!1,type:[Number,String],default:0},modelValue:{required:!1,type:[Number,String,void 0,null],default:null},modelModifiers:{required:!1,type:Object,default:()=>({number:!1})},masked:{type:Boolean,default:!1},precision:{type:Number,default:()=>o.precision},decimal:{type:String,default:()=>o.decimal,validator:e=>s(e,"decimal")},thousands:{type:String,default:()=>o.thousands,validator:e=>s(e,"thousands")},prefix:{type:String,default:()=>o.prefix,validator:e=>s(e,"prefix")},suffix:{type:String,default:()=>o.suffix,validator:e=>s(e,"suffix")},disableNegative:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},max:{type:Number,default:()=>o.max},min:{type:Number,default:()=>o.min},allowBlank:{type:Boolean,default:()=>o.allowBlank},minimumNumberOfCharacters:{type:Number,default:()=>o.minimumNumberOfCharacters}},directives:{money3:b},setup(e,{emit:o,attrs:n}){e.debug&&console.log("component setup()",e);const a=t.reactive({formattedValue:c(e.modelValue,e,"component setup")});e.debug&&console.log("component setup() - data.formattedValue",a.formattedValue),t.watch((()=>e.modelValue),(t=>{e.debug&&console.log("component watch() -> val",t);const o=c(t,e,"component watch");o!==a.formattedValue&&(e.debug&&console.log("component watch() changed -> formatted",o),a.formattedValue=o)}));const l=t.computed((()=>{const e=__spreadValues({},n);return delete e["onUpdate:modelValue"],e}));return{data:a,listeners:l,change:function(t){e.debug&&console.log("component change() -> evt.target.value",t.target.value);const n=e.masked&&!e.modelModifiers.number?t.target.value:m(t.target.value,e,"component change");e.debug&&console.log("component change() -> update:model-value",n),o("update:model-value",n)}}}}),h=["id","value","disabled"];y.render=function(e,o,n,a,l,u){const r=t.resolveDirective("money3");return t.withDirectives((t.openBlock(),t.createElementBlock("input",t.mergeProps({type:"tel",id:e.id,value:e.data.formattedValue,disabled:e.disabled,onChange:o[0]||(o[0]=(...t)=>e.change&&e.change(...t))},e.listeners,{class:"v-money3"}),null,16,h)),[[r,{precision:e.precision,decimal:e.decimal,thousands:e.thousands,prefix:e.prefix,suffix:e.suffix,disableNegative:e.disableNegative,min:e.min,max:e.max,allowBlank:e.allowBlank,minimumNumberOfCharacters:e.minimumNumberOfCharacters,debug:e.debug}]])};const x={install:e=>{e.component("money3",y),e.directive("money3",b)}};e.Money=y,e.Money3=y,e.Money3Component=y,e.Money3Directive=b,e.VMoney=b,e.VMoney3=b,e.default=x,e.format=c,e.unformat=m,Object.defineProperty(e,"__esModule",{value:!0}),e[Symbol.toStringTag]="Module"}));
