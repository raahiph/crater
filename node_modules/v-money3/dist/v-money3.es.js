var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o;import{defineComponent as l,reactive as u,watch as i,computed as r,resolveDirective as s,withDirectives as d,openBlock as c,createElementBlock as m,mergeProps as f}from"vue";var p={debug:!1,masked:!1,prefix:"",suffix:"",thousands:",",decimal:".",precision:2,disableNegative:!1,disabled:!1,min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,allowBlank:!1,minimumNumberOfCharacters:0};const g=["+","-"],v=["decimal","thousands","prefix","suffix"];function b(e){const t=Math.floor(Number(e));return t!==1/0&&String(t)===e&&t>=0}function h(e){return t=0,n=e,o=20,Math.max(t,Math.min(n,o));var t,n,o}function y(e,t){const n=10**t;return(parseFloat(e)/n).toFixed(h(t))}function x(e){return e?e.toString():""}function N(e){return x(e).replace(/\D+/g,"")||"0"}function w(e,t){if(g.includes(e))throw new Error(`v-money3 "${t}" property don't accept "${e}" as a value.`);return!0}function O(e,t=p,n){t.debug&&console.log("utils format() - caller",n),t.debug&&console.log("utils format() - input1",e),null==e&&(e=0),t.allowBlank&&b(e)&&(e=y(e,h(t.precision))),"number"==typeof e?e=Number(e).toFixed(h(t.precision)):Number.isNaN(e)||(b(e)?e=Number(e).toFixed(h(t.precision)):/^-?[\d]*(\.[\d]+)?$/g.test(e)&&(n&&"component setup"!==n&&"directive mounted"!==n||(e=Number(e).toFixed(h(t.precision))))),t.debug&&console.log("utils format() - input2",e);const o=t.disableNegative?"":e.indexOf("-")>=0?"-":"",a=N(e.replace(t.prefix,"").replace(t.suffix,""));let l=Number(y(a,t.precision));if(t.debug&&console.log("utils format() - currency1",l),l>t.max?l=t.max:l<t.min&&(l=t.min),t.debug&&console.log("utils format() - currency2",l),l=l.toFixed(h(t.precision)),/^0(\.0+)?$/g.test(l)&&t.allowBlank)return"";const u=x(l).split(".");if(t.minimumNumberOfCharacters>0){const e=`${u[0]}`.length+`${u[1]}`.length,n=t.minimumNumberOfCharacters-e;if(n>0)for(let t=0;t<n;t+=1)u[0]=`0${u[0]}`}let i=u[0];const r=u[1];i=function(e,t){return e.replace(/(\d)(?=(?:\d{3})+\b)/gm,`$1${t}`)}(i,t.thousands);const s=t.prefix+o+function(e,t,n){return t?e+n+t:e}(i,r,t.decimal)+t.suffix;return t.debug&&console.log("utils format() - output",s),s}function k(e,t=p,n){t.debug&&console.log("utils unformat() - caller",n),t.debug&&console.log("utils unformat() - input",e);const o=t.disableNegative?1:e.indexOf("-")>=0?-1:1;let a=y(N(e.replace(t.prefix,"").replace(t.suffix,"")),t.precision);a=parseFloat(a)*o,a>t.max?a=t.max:e<t.min&&(a=t.min);let l=Number(a).toFixed(h(t.precision));return t.modelModifiers&&t.modelModifiers.number&&(l=parseFloat(l)),t.debug&&console.log("utils unformat() - output",l),l}function E(e){const t=document.createEvent("Event");return t.initEvent(e,!0,!0),t}var M=(e,t)=>(e=e||{},t=t||{},Object.keys(e).concat(Object.keys(t)).reduce(((n,o)=>(n[o]=void 0===t[o]?e[o]:t[o],n)),{}));let B=null;const V=(e,t,n)=>{if(B===e.value)return void(t.debug&&console.log("directive setValue() - lastKnownValue === el.value. Stopping here...",e.value));!function(e){for(const t of v)w(e[t],t)}(t);let o=e.value.length-e.selectionEnd;e.value=O(e.value,t,n),B=e.value,o=Math.max(o,t.suffix.length),o=e.value.length-o,o=Math.max(o,t.prefix.length),function(e,t){const n=()=>{e.setSelectionRange(t,t)};e===document.activeElement&&(n(),setTimeout(n,1))}(e,o),e.dispatchEvent(E("change"))};var S={mounted(e,t){if(!t.value)return;const n=M(p,t.value);if(n.debug&&console.log("directive mounted() - opt",n),"INPUT"!==e.tagName.toLocaleUpperCase()){const t=e.getElementsByTagName("input");1!==t.length||(e=t[0])}e.onkeydown=t=>{const o="Backspace"===t.code||"Delete"===t.code,a=e.value.length-e.selectionEnd==0;if(n.allowBlank&&o&&a&&0===k(e.value,0)&&(e.value="",e.dispatchEvent(E("change"))),"+"===t.key){const t=k(e.value,n);t<0&&(e.value=-1*t)}},e.oninput=()=>{/^[1-9]$/.test(e.value)&&(e.value=y(e.value,h(n.precision))),V(e,n,"directive oninput")},n.debug&&console.log("directive mounted() - el.value",e.value),V(e,n,"directive mounted")},updated(e,t){if(!t.value)return;const n=M(p,t.value);n.debug&&console.log("directive updated() - el.value",e.value),V(e,n,"directive updated")},beforeUnmount(e){e.onkeydown=null,e.oninput=null,e.onfocus=null}};const F=l({inheritAttrs:!1,name:"Money3",props:{debug:{required:!1,type:Boolean,default:!1},id:{required:!1,type:[Number,String],default:0},modelValue:{required:!1,type:[Number,String,void 0,null],default:null},modelModifiers:{required:!1,type:Object,default:()=>({number:!1})},masked:{type:Boolean,default:!1},precision:{type:Number,default:()=>p.precision},decimal:{type:String,default:()=>p.decimal,validator:e=>w(e,"decimal")},thousands:{type:String,default:()=>p.thousands,validator:e=>w(e,"thousands")},prefix:{type:String,default:()=>p.prefix,validator:e=>w(e,"prefix")},suffix:{type:String,default:()=>p.suffix,validator:e=>w(e,"suffix")},disableNegative:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},max:{type:Number,default:()=>p.max},min:{type:Number,default:()=>p.min},allowBlank:{type:Boolean,default:()=>p.allowBlank},minimumNumberOfCharacters:{type:Number,default:()=>p.minimumNumberOfCharacters}},directives:{money3:S},setup(e,{emit:l,attrs:s}){e.debug&&console.log("component setup()",e);const d=u({formattedValue:O(e.modelValue,e,"component setup")});e.debug&&console.log("component setup() - data.formattedValue",d.formattedValue),i((()=>e.modelValue),(t=>{e.debug&&console.log("component watch() -> val",t);const n=O(t,e,"component watch");n!==d.formattedValue&&(e.debug&&console.log("component watch() changed -> formatted",n),d.formattedValue=n)}));const c=r((()=>{const e=((e,l)=>{for(var u in l||(l={}))n.call(l,u)&&a(e,u,l[u]);if(t)for(var u of t(l))o.call(l,u)&&a(e,u,l[u]);return e})({},s);return delete e["onUpdate:modelValue"],e}));return{data:d,listeners:c,change:function(t){e.debug&&console.log("component change() -> evt.target.value",t.target.value);const n=e.masked&&!e.modelModifiers.number?t.target.value:k(t.target.value,e,"component change");e.debug&&console.log("component change() -> update:model-value",n),l("update:model-value",n)}}}}),C=["id","value","disabled"];F.render=function(e,t,n,o,a,l){const u=s("money3");return d((c(),m("input",f({type:"tel",id:e.id,value:e.data.formattedValue,disabled:e.disabled,onChange:t[0]||(t[0]=(...t)=>e.change&&e.change(...t))},e.listeners,{class:"v-money3"}),null,16,C)),[[u,{precision:e.precision,decimal:e.decimal,thousands:e.thousands,prefix:e.prefix,suffix:e.suffix,disableNegative:e.disableNegative,min:e.min,max:e.max,allowBlank:e.allowBlank,minimumNumberOfCharacters:e.minimumNumberOfCharacters,debug:e.debug}]])};const $={install:e=>{e.component("money3",F),e.directive("money3",S)}};export{F as Money,F as Money3,F as Money3Component,S as Money3Directive,S as VMoney,S as VMoney3,$ as default,O as format,k as unformat};
